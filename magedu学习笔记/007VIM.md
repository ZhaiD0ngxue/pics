007VIM

# 文本编辑工具之神VIM  
## vi和vim简介 

文本编辑种类：

* 全屏编辑器：nano（字符工具）, gedit(图形化工具)，vi,vim
* 行编辑器：sed  

vi/vim分支:
* vi: Visual editor，文本编辑器，是 Linux 必备工具之一，功能强大，学习曲线较陡峭，学习难度大  
* vim:VIsual editor iMproved ，和 vi 使用方法一致，但功能更为强大，不是必备软件 
* gvim:一个Vim编辑器的图形版本


## 使用VIM
### vim命令格式  

```
vim [OPTION]... FILE...
```

选项:

```
+#			 打开文件后，让光标处于第#行的行首，+默认行尾
+/PATTERN 		让光标处于第一个被PATTERN匹配到的行行首
-b file 		二进制方式打开文件
-d file1 file2… 	比较多个文件，相当于 vimdiff
-m file 		只读打开文件
-e file 		直接进入ex模式，相当于执行ex file
-y file 		Easy mode (like "evim", modeless)，直接可以操作文件，ctrl+o:wq|q! 保存和不保存退出
```

说明:  

* 如果该文件存在，文件被打开并显示内容  
* 如果该文件不存在，当编辑后第一次存盘时创建它  


### 三种主要模式和转换  

三种常见模式：  
* 命令或普通(Normal)模式：默认模式，可以实现移动光标，剪切/粘贴文本
* 插入(Insert)或编辑模式：用于修改文本
* 扩展命令(extended command )或命令(末)行模式：保存，退出等  

模式转换:  

![](https://raw.githubusercontent.com/ZhaiD0ngxue/pics/main/img/7-1.png)  

* 命令模式 --> 插入模式  

```
i	insert, 在光标所在处输入
I 	在当前光标所在行的行首输入
a	append, 在光标所在处后面输入
A	在当前光标所在行的行尾输入
o 	在当前光标所在行的下方打开一个新行
O 	在当前光标所在行的上方打开一个新行
```  

* 插入模式 --- ESC-----> 命令模式
* 命令模式 ---- : ----> 扩展命令模式
* 扩展命令模式 ----ESC,enter----> 命令模式

## 扩展命令模式  
按:进入Ex模式 ,创建一个命令提示符:处于底部的屏幕左侧


### 扩展命令模式基本命令  

```
w 		写（存）磁盘文件
wq 		保存并退出
x 		保存并退出,不推荐使用,防止和X混淆
X 		加密,set key= 来删除密码
q 		退出
q！ 		不存盘退出，即使更改都将丢失
r filename 	读文件内容到当前文件中,
w filename 	将当前文件内容写入另一个文件,另存为.
!command 	执行命令
r!command 	读入命令的输出
```

### 地址定界  
格式:  

```
:start_pos,end_pos CMD
```

定界:  

```
# 		#具体第#行，例如2表示第2行
#,# 		#从左侧#表示起始行，到右侧#表示结尾行
#,+# 		#从左侧#表示的起始行，加上右侧#表示的行数，范例：2,+3 表示2到5行
. 		#当前行
$ 		#最后一行
.,$-1 		#当前行到倒数第二行
% 		#全文, 相当于1,$
/pattern/ 	#从当前行向下查找，直到匹配pattern的第一行,即:正则表达式
/pat1/,/pat2/ 	#从第一次被pat1模式匹配到的行开始，一直到第一次被pat2匹配到的行结束
#,/pat/ 	#从指定行开始，一直找到第一个匹配patttern的行结束
/pat/,$ 	#向下找到第一个匹配patttern的行到整个文件的结尾的所有行
```

命令:  

```
d 		#删除
y 		#复制
w file 		#将范围内的行另存至指定文件中
r file 		#在指定位置插入指定文件中的所有内容
```

### 查找和替换  
格式:  

```
s/要查找的内容/替换为的内容/修饰符
```

**查找替换中的分隔符/可替换为其它字符，如：#,@**  


说明:  
要查找的内容：可使用基本正则表达式模式  
替换为的内容：不能使用模式，但可以使用\1, \2, ...等后向引用符号；还可以使用“&”引用前面查找时查找到的整个内容

修饰符:  

```
i 	#忽略大小写
g 	#全局替换，默认情况下，每一行只替换第一次出现
gc 	#全局替换，每次替换前询问
```

范例:  

```
:%s/vim/VIM/g
:%s/\(r..t\)/\1er/g		#后向引用
:%s/r..t/&er/g			#后向引用
```

### 定制vim工作特性
扩展命令模式的配置只是对当前vim进程有效，可将配置存放在文件中持久保存  

**配置文件:**  

```
/etc/vimrc		#全局
~/.vimrc 		#个人
```


#### 行号  
显示：set number，简写 set nu  
取消显示：set nonumber, 简写 set nonu  


#### 忽略字符的大小写
启用：set ignorecase，简写 set ic  
不忽略：set noic  

#### 自动缩进  
启用：set autoindent，简写 set ai  
禁用：set noai  

#### 复制保留格式
启用：set paste  
禁用：set nopaste  

#### 显示Tab ^I和换行符 和$显示(显示隐藏字符)  
启用：set list  
禁用：set nolist

#### 高亮搜索  
启用：set hlsearch  
禁用：set nohlsearch 简写：nohl  

#### 语法高亮  
启用：syntax on  
禁用：syntax off   

#### 文件格式  
启用windows格式：set fileformat=dos  
启用unix格式：set fileformat=unix  

简写 set ff=dos|unix

#### Tab 用空格代替  
启用：set expandtab 默认为8个空格代替Tab,简写:set et  
禁用：set noexpandtab  简写:set noet

#### Tab用指定空格的个数代替
启用：set tabstop=# 指定#个空格代替Tab 简写：set ts=4

#### 设置文本宽度  
set textwidth=65 (vim only)  
set wrapmargin=15

#### 设置光标所在行的标识线  
启用：set cursorline，简写 set cul  
禁用：set nocursorline

#### 加密  
启用： set key=[password]  #此处写要设定的密码
禁用： set key=  

#### 了解更多
set 帮助  
:help option-list  
:set or :set all  

## 命令模式  
命令模式，又称为Normal模式，功能强大，只是此模式输入指令并在屏幕上显示，所以需要记忆大量的快捷按键才能更好的使用.  

![](https://raw.githubusercontent.com/ZhaiD0ngxue/pics/main/img/7-2.png)   

### 退出VIM  
ZZ 保存退出  
ZQ 不保存退出  

### 光标跳转 

**注意:  
单词的分界符是"除数字字母下划线之外"的字符  
句子的分界符是"点+一个空格"  
段落的分界符是一个空行**

* 字符间跳转  
	* h: 左 l: 右 j: 下 k: 上
	* #COMMAND：跳转由#指定的个数的字符  
* 单词间跳转
	* w：下一个单词的词首
	* e：当前或下一单词的词尾
	* b：当前或前一个单词的词首
	* #COMMAND：由#指定一次跳转的单词数
* 当前页跳转
	* H：页首  M：页中间行  L：页底
	* zt：将光标所在当前行移到屏幕顶端
	* zz：将光标所在当前行移到屏幕中间
	* zb：将光标所在当前行移到屏幕底端
* 行首行尾跳转
	* ^ 跳转至行首的第一个非空白字符
	* 0 跳转至行首
	* $ 跳转至行尾
* 行间移动：
	* #G 或者扩展命令模式下 :# 跳转至由第#行
	* G 最后一行
	* 1G, gg 第一行
* 句间移动：
	* ) 下一句 ( 上一句
* 段落间移动：
	* } 下一段 { 上一段
* 命令模式翻屏操作
	* Ctrl+f 向文件尾部翻一屏
	* Ctrl+b 向文件首部翻一屏
	* Ctrl+d 向文件尾部翻半屏
	* Ctrl+u 向文件首部翻半屏

### 字符编辑  
x			删除光标处的字符    
#x			删除光标处起始的#个字符  
xp			交换光标所在处的字符及其后面字符的位置  
~ 			转换大小写  
J 			删除当前行后的换行符  


### 替换命令(replace)  
r 只替换光标所在处的一个字符  
R 切换成REPLACE模式（在末行出现-- REPLACE -- 提示）,按ESC回到命令模式

### 删除命令(delete)  
d 		删除命令，可结合光标跳转字符，实现范围删除  
d$ 		删除到行尾  
d^ 		删除到非空行首  
d0 		删除到行首  
dw  	从当前光标位置向后删除一个单词(后面的空格也被删除)  
de  	从当前光标位置向后删除一个单词  
db  	从当前光标前一个位置向前删除一个单词(不包括当前光标出的字符)  
#COMMAND  此处#代表次数,COMMAND代表操作,如3de  
dd		剪切光标所在的行  
#dd 	多行删除  
D		从当前光标位置一直删除到行尾，等同于d$  


### 复制命令(yank)  
y 		复制，行为相似于d命令  
y$		复制到行尾的字符  
y0		复制到行首的字符(真正的行首,0的位置)  
y^		复制到行首的字符	
yw		从当前光标位置向后复制一个单词(后面的空格也被复制)   
ye		从当前光标位置向后复制一个单词  
yb		从当前光标前一个位置向前复制一个单词(不包括当前光标出的字符)  
#COMMAND  此处#代表次数,COMMAND代表操作,如3ye   
yy		复制行  
#yy 	复制多行  
Y		复制整行  

### 粘贴命令(paste)  
p 缓冲区存的如果为整行，则粘贴当前光标所在行的下方；否则，则粘贴至当前光标所在处的后面  
P 缓冲区存的如果为整行，则粘贴当前光标所在行的上方；否则，则粘贴至当前光标所在处的前面  

### 改变命令(change)  
c 		删除后切换成插入模式  
c$		删除到行尾后切换成插入模式   
c^		删除到行首后切换成插入模式  
c0		删除到行首后切换成插入模式(0的位置)  
cb		从当前光标前一个位置向前删除一个单词,然后切换到插入模式(不包括当前光标出的字符)    
ce		从当前光标位置向后删除一个单词,然后切换到插入模式  
cw		从当前光标位置向后删除一个单词,然后切换到插入模式  
#COMMAND	此处#代表次数,COMMAND代表操作,如3ce  
cc		删除当前行并输入新内容，相当于S  
#cc		删除多行并进入插入模式  
C		删除当前光标到行尾，并切换成插入模式,相当于c$  

### 查找
/PATTERN		:从当前光标所在处向文件尾部查找  
?PATTERN		:从当前光标所在处向文件首部查找  
n		:与命令同方向  
N		:与命令反方向  

### 撤消更改  
u 	撤销最近的更改，相当于windows中ctrl+z    
#u 	撤销之前多次更改    
U	撤消光标落在这行后所有此行的更改  
Ctrl-r 	重做最后的“撤消”更改，相当于windows中crtl+y  
. 	重复前一个操作    
#.	重复前一个操作#次  

### 高级用法  

```
<start position><command><end position>

常见Command：y 复制、d 删除、gU 变大写、gu 变小写
```

范例:  

```
0yw			#从当前行0的位置开始复制到行尾的字符
100izhaidx[ESC]		#切换到插入模式输入100次zhaidx  
di" 		#光标在""之间，则删除""之间的内容
yi( 		#光标在()之间，则复制()之间的内容
vi[ 		#光标在[]之间，则选中[]之间的内容
dtx 		#删除字符直到遇见光标之后的第一个 x 字符
ytx 		#复制字符直到遇见光标之后的第一个 x 字符
```

## 可视化模式  
在末行有”-- VISUAL -- “指示，表示在可视化模式 

**允许选择的文本块**  
* v 面向字符，-- VISUAL --  
* V 面向整行，-- VISUAL LINE --  
* ctrl-v 面向块，-- VISUAL BLOCK --  

可视化模式可以与移动键结合使用,h,j,k,l,w,),}等等.  
突出显示的文字可被删除,复制,变更,过滤,搜索,替换等操作.  

范例:

```
实现的效果是,在每一行的开头添加#号.

1、先将光标移动到第一行的行首
2、输入ctrl+v 进入可视化模式
3、输入 G 跳到最后1行，选中每一行的第一个字符
4、输入 I 切换至插入模式
5、输入 #
6、按 ESC 键
```

```
实现的效果是,在指定的块位置插入相同的内容
1、光标定位到要操作的地方
2、CTRL+v 进入“可视 块”模式，选取这一列操作多少行
3、SHIFT+i(即I)
4、输入要插入的内容
5、按 ESC 键
```


## 多文件模式  

```
vim FILE1 FILE2 FILE3 ...	vim打开多个文件
:next 		下一个
:prev 		前一个
:first 		第一个
:last 		最后一个
:wall 		保存所有
:qall 		不保存退出所有
:wqall		保存退出所有
```

## 多窗口模式  

```
Ctrl+w,s		：split, 水平分割，上下分屏
Ctrl+w,v		：vertical, 垂直分割，左右分屏
ctrl+w,q		：取消相邻窗口
ctrl+w,o		：取消全部窗口
:wqall 			: 退出
```  


## vim的寄存器  
* VIM有26个命名寄存器和1个无命名寄存器，常存放不同的剪贴版内容.  
* 可以在同一个主机的不同会话（终端窗口）间共享寄存器名称a，b,…,z  


格式： "寄存器  ,放在数字和命令之间  
范例:  

```
3"tyy 	#表示复制3行到t寄存器中 ，末行显示 3 lines yanked into "t
"tp 	#表示将t寄存器内容粘贴
```  

* 未指定寄存器的情况，将使用无命名寄存器  
* 有10个数字寄存器，用0，1，…，9表示，0存放最近复制内容，1存放最近删除内容。  
* 当新的文本变更和删除时，1转存到2，2转存到3，以此类推。数字寄存器不能在不同会话间共享  


## 标记和宏(macro) 

```
ma 		#将当前位置标记为a，26个字母均可做标记， mb 、 mc 等等
`a 		#跳转到a标记的位置，实用的文档内标记方法，文档中跳跃编辑时很有用
qa 		#录制宏 a，a为宏的名称，末行提示： recording @a
q 		#停止录制宏
@a 		#执行宏 a 的操作
10@a		#执行10次宏 a 的操作
@@ 		#重新执行上次执行的宏
```

## 编辑二进制文件  

```
#以二进制方式打开文件
vim -b binaryfile
#扩展命令模式下，利用xxd命令转换为可读的十六进制
:%!xxd
#切换至插入模式下，编辑二进制文件

#切换至扩展命令模式下，利用xxd命令转换回二进制
:%!xxd -r
#保存退出
```

## 帮助 

```
:help		#帮助
:help topic	#某个功能的帮助

Use :q to exit help	#退出帮助

vimtutor	#一个可供练习的环境
```

## 小技巧 
### VIM添加颜色字符的方法  

```
1 切换至插入模式
2 按ctrl+v+[ 三个键,显示^[
3 后续输入颜色信息,如:^[[32mhello^[[0m
4 切换至扩展命令模式,保存退出
5 cat 文件可以看到下面显示
```